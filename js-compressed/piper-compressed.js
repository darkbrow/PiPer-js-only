var a;
a||(a=!0,(()=>{console.trace.bind(console);const n=console.info.bind(console,"[PiPer] "),t=console.warn.bind(console,"[PiPer] "),C=console.error.bind(console,"[PiPer] "),l=function(){return/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)?1:/Chrome/.test(navigator.userAgent)&&/Google/.test(navigator.vendor)?2:0};let f=null;const v=function(b){switch(l()){case 1:return safari.extension.baseURI+b;case 2:return chrome.runtime.getURL(b);default:return b}},D=function(){f.captionElement||t("Unnecessary bypassing of background timer throttling on page without caption support");
const b=new XMLHttpRequest;b.open("GET",v("scripts/fix.js"));b.onload=function(){const c=document.createElement("script");c.setAttribute("type","module");c.appendChild(document.createTextNode(b.responseText));document.head.appendChild(c)};b.send()},w=[],y=function(b){-1==w.indexOf(b)&&w.push(b);1==l()&&document.addEventListener("webkitpresentationmodechanged",A,{capture:!0})},z=function(b){var c=f.videoElement(!0);if(b==c){(c=B(b))?n("Video entering Picture in Picture mode"):n("Video leaving Picture in Picture mode");
var d=w.slice();for(let g;g=d.pop();)g(b,c)}},A=function(b){z(b.target)},B=function(b){switch(l()){case 1:return"picture-in-picture"==b.webkitPresentationMode;case 2:return b.hasAttribute("data-playing-picture-in-picture");default:return!1}},G=function(b){const c=b.target;c.setAttribute("data-playing-picture-in-picture",!0);z(c);c.addEventListener("leavepictureinpicture",function(d){c.removeAttribute("data-playing-picture-in-picture");z(c)},{once:!0})},k={"button-title":{en:"Open Picture in Picture mode",
de:"Bild-in-Bild starten",ko:"\ud654\uba74 \uc18d \ud654\uba74",nl:"Beeld in beeld starten",fr:"D\u00e9marrer Image dans l\u2019image"}},m=function(b,c=navigator.language.substring(0,2)){const d=k[b];if(d&&(c=d[c]||d.en))return c;C(`No localized string found for key '${b}'`);return""};let e=null,p=!1,x=!1,H=!1,I="";const M=function(b){f.captionElement&&(p=!0,y(L),n("Closed caption support enabled"),!b&&(b=f.videoElement(!0)))&&(x=B(b),e=J(b),E())},J=function(b){const c=b.textTracks;for(let d=c.length;d--;)if("PiPer_track"===
c[d].label)return n("Existing caption track found"),c[d];n("Caption track created");return b.addTextTrack("captions","PiPer_track","en")},L=function(b,c){if(x=c)e=J(b),e.mode="showing";I="";E();n(`Video presentation mode changed (showingCaptions: ${x})`)},N=function(b,c=!0){for(;e.activeCues.length;)e.removeCue(e.activeCues[0]);1==l()&&c&&b&&!H&&(e.addCue(new VTTCue(b.currentTime,b.currentTime+60,"")),H=!0)},E=function(){var b=f.captionElement();const c=f.videoElement();if(x&&b){b.style.visibility=
"hidden";var d=b.textContent;if(d!=I&&(I=d,N(c,!d),d)){d="";for(b=document.createTreeWalker(b,NodeFilter.SHOW_TEXT,null,!1);b.nextNode();){const g=b.currentNode.nodeValue.trim();if(g){const q=window.getComputedStyle(b.currentNode.parentElement);d="italic"==q.fontStyle?d+`<i>${g}</i>`:"underline"==q.textDecoration?d+`<u>${g}</u>`:d+g;d+=" "}else"\n"!=d.charAt(d.length-1)&&(d+="\n")}d=d.trim();n(`Showing caption '${d}'`);e.mode="showing";e.addCue(new VTTCue(c.currentTime,c.currentTime+60,d));1==l()&&
(H=!1)}}else N(c),b&&(b.style.visibility="")};let r=null;const Q=function(b){if(!r){r=document.createElement(f.buttonElementType||"button");r.id="PiPer_button";r.title=m("button-title");var c=f.buttonStyle;c&&(r.style.cssText=c);if(c=f.buttonClassName)r.className=c;const g=document.createElement("img");g.style.width=g.style.height="100%";if(c=f.buttonScale)g.style.transform=`scale(${c})`;r.appendChild(g);c=f.buttonImage;var d=f.buttonExitImage;c||(c="default",d="default-exit");const q="https://gist.githubusercontent.com/darkbrow/abfec4b22576d06a633346f06c3cc2f2/raw/444d3b120581cc4d8bf4a913d89948b10802c7c2/"+
`${c}.svg`;g.src=q;if(d){const h="https://gist.githubusercontent.com/darkbrow/abfec4b22576d06a633346f06c3cc2f2/raw/444d3b120581cc4d8bf4a913d89948b10802c7c2/"+`${d}.svg`;y(function(u,P){g.src=P?h:q})}if(c=f.buttonHoverStyle)d=document.createElement("style"),d.appendChild(document.createTextNode(`#${"PiPer_button"}:hover{${c}}`)),r.appendChild(d);r.addEventListener("click",function(h){h.preventDefault();if(h=f.videoElement(!0)){const u=B(h);switch(l()){case 1:u?h.webkitSetPresentationMode("inline"):
h.webkitSetPresentationMode("picture-in-picture");break;case 2:u?(h=document.createElement("script"),h.textContent="document.exitPictureInPicture()",document.head.appendChild(h),h.remove()):(h.removeAttribute("disablepictureinpicture"),h.requestPictureInPicture())}}else C("Unable to find video")});n("Picture in Picture button created")}c=f.buttonInsertBefore?f.buttonInsertBefore(b):null;b.insertBefore(r,c)},R=function(){let b=0;const c=function(g){let q=null;return function(h){const u=q?document.getElementById(q):
null;if(u&&!h)return u;if(h=g())h.id||(h.id="PiPer_"+b++),q=h.id;return h}},d=f;d.buttonParent=c(d.buttonParent);d.videoElement=c(d.videoElement);d.captionElement&&(d.captionElement=c(d.captionElement))},F={naver:{buttonClassName:"control",buttonScale:.7,buttonStyle:"\n    /* Declaring CSS this way ensures it gets optimized when the extension is built */\n    cursor: pointer;\n    opacity: 1;\n    padding: 0 0 0 12px;\n    background-color: transparent;\n    border-style: none;\n  ",buttonHoverStyle:"opacity: 1 !important",
buttonParent:function(){var b=[document.querySelector(".ControlBox_comp_control_box__zduPu .ControlBox_view_control_group__1DCTL"),document.querySelector(".VideoControlBox_view_control_group__Gls_j"),document.querySelector(".rmc_control_right"),document.querySelector(".pzp-pc__bottom-buttons-right")],c=b.findIndex(function(d){return null!==d});return b[c]},videoElement:function(){return document.querySelector(".webplayer-internal-video")}},vid:{buttonInsertBefore:function(b){return b.lastChild},buttonParent:function(){return document.querySelector(".vjs-control-bar")},
buttonScale:.7,buttonStyle:"\n    position: relative;\n    top: -2px;\n    left: 9px;\n    padding: 0px;\n    margin: 0px;\n  ",videoElement:function(){return document.getElementById("video_player_html5_api")}},youtube:{buttonClassName:"ytp-button",buttonDidAppear:function(){var b=r;const c=b.nextSibling,d=b.title,g=c.title;b.title="";b.addEventListener("mouseover",function(){c.title=d;c.dispatchEvent(new Event("mouseover"))});b.addEventListener("mouseout",function(){c.dispatchEvent(new Event("mouseout"));
c.title=g});D();if(1==l()){f.videoElement();let q=!1;b=function(){if(q=p&&x){x=p=!1;E();const u=w.indexOf(L);-1<u&&w.splice(u,1);1==l()&&0==w.length&&document.removeEventListener("webkitpresentationmodechanged",A);n("Closed caption support disabled")}};const h=function(){q&&M()};window.addEventListener("spfrequest",b);window.addEventListener("spfdone",h);window.addEventListener("yt-navigate-start",b);window.addEventListener("yt-navigate-finish",h)}},buttonInsertBefore:function(b){return b.lastChild},
buttonParent:function(){return document.querySelector(".ytp-right-controls")},buttonScale:.68,captionElement:function(){return document.querySelector(".caption-window")},videoElement:function(){return document.querySelector("video.html5-main-video")}}};F.youtu=F.youtube;const O=function(){const b=f;p&&x&&E();if(2==l()){var c=document.getElementsByTagName("video");for(let d=0,g;g=c[d];d++)g.addEventListener("enterpictureinpicture",G)}if(1==l()&&b.captionElement){c=document.getElementsByTagName("video");
for(let d=0,g;g=c[d];d++)J(g)}!document.getElementById("PiPer_button")&&(c=b.buttonParent())&&(Q(c),b.buttonDidAppear&&b.buttonDidAppear(),n("Picture in Picture button added to webpage"))};var K=32400==location.port?"plex":(location.hostname.match(/([^.]+)\.(?:com?\.)?[^.]+$/)||[])[1];K in F&&(n(`Matched site ${K} (${location})`),f=F[K],R(),1==l()&&M(!0),(new MutationObserver(O)).observe(document,{childList:!0,subtree:!0}),O())})());
a||(a=!0,(()=>{console.trace.bind(console);const n=console.info.bind(console,"[PiPer] ");console.warn.bind(console,"[PiPer] ");console.error.bind(console,"[PiPer] ");let t=null,C=0,l={};const f=[],v=[],D=window.setTimeout,w=window.clearTimeout,y=window.requestAnimationFrame;window.requestAnimationFrame=function(k){let m=0;t||(m=y(k),f.push(m));v.push(k);return m};const z=function(){f.length=0;v.length=0;y(z)};z();const A=function(){var k=v.slice();v.length=0;const m=window.performance.now();for(var e;e=
k.pop();)e(m);k=l;l={};for(let p in k)if(e=k[p],e[0]<=m)if("function"==typeof e[1])e[1]();else eval(e[1]);else l[p]=e},B=function(k,m){const e=C++;l[e.toString()]=[window.performance.now()+(m||0),k];return e},G=function(k){k&&delete l[k.toString()]};document.addEventListener("visibilitychange",function(){if(document.hidden){var k=document.querySelectorAll("video");for(var m=k.length;m--;){var e=k[m];a:{var p=e;switch(/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)?1:/Chrome/.test(navigator.userAgent)&&
/Google/.test(navigator.vendor)?2:0){case 1:p="picture-in-picture"==p.webkitPresentationMode;break a;case 2:p=p.hasAttribute("data-playing-picture-in-picture");break a;default:p=!1}}if(p){t=e;break}}if(t){for(;k=f.pop();)window.cancelAnimationFrame(k);window.setTimeout=B;window.clearTimeout=G;t.addEventListener("timeupdate",A);n("Bypassing background timer throttling")}}else if(t){n("Finished bypassing background timer throttling");window.setTimeout=D;window.clearTimeout=w;t.removeEventListener("timeupdate",
A);t=null;for(m=v.length;m--;)e=y(v[m]),f.push(e);m=window.performance.now();for(k in l)e=l[k],D(e[1],e[0]-m);l={}}})})());
